// ==UserScript==
// @name           TraceCollector
// @namespace      http://trace.ozalid.com
// @description    
// @include        *
// @require       http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js
// ==/UserScript==
// alert('s');

$(document).ready(function(){
	$("td,input,button,a").click(function(e){
	console.log("onclick");
	
	var obselset = [];
	if (localStorage["obselset"]==undefined){
		localStorage["obselset"] = [];
	}
	else{
		obselset = JSON.parse(localStorage["obselset"]);
	}
	
	var obsel = {
	"type": "click",
	"start": new Date(),
	"content": 	"element id = '" + e.target.id + "', " 
				+ "element_name = '" + e.target.nodeName + "'" 		
	};
	
	obselset.push(obsel);
	localStorage["obselset"] = JSON.stringify(obselset);
	console.log("save localStorage");
});
	
	$("input,textarea").keypress(function(e){
		console.log("onkeypress");
		var keyCode = (e.keyCode ? e.keyCode : e.which);
		
		
		var obselset = [];
		if (localStorage["obselset"]==undefined){
			localStorage["obselset"] = [];
		}
		else{
			obselset = JSON.parse(localStorage["obselset"]);
		}
		
		var obsel = {
		"type": "keypress",
		"start": new Date(),
		"content": 	"keycode = '" + keyCode + "', " 
					+ "charCode = '" + e.charCode + "'" 		
		};
		
		obselset.push(obsel);
		localStorage["obselset"] = JSON.stringify(obselset);
		console.log("save localStorage");
	});
});

// window.onkeypress = function dokeypress(e){
	
// };
	
// window.onclick = function doclick(e){
	// console.log("onclick");
	
	// var obselset = [];
	// if (localStorage["obselset"]==undefined){
		// localStorage["obselset"] = [];
	// }
	// else{
		// obselset = JSON.parse(localStorage["obselset"]);
	// }
	
	// var obsel = {
	// "type": "click",
	// "start": new Date(),
	// "content": 	"element id = '" + e.target.id + "', " 
				// + "element_name = '" + e.target.nodeName + "'" 		
	// }
	
	// obselset.push(obsel);
	// localStorage["obselset"] = JSON.stringify(obselset);
	// console.log("save localStorage");
// };	